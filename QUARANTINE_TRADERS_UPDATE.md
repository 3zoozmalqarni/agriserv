# تحديث: حفظ بيانات التجار في الحجر البيطري

## التحديثات المُنفذة

### 1. إنشاء جدول قاعدة البيانات

تم إنشاء جدول `quarantine_traders` في Supabase لحفظ بيانات التجار:

**الحقول:**
- `id` - معرف فريد
- `shipment_id` - رقم الإجراء البيطري
- `trader_name` - اسم التاجر
- `permit_number` - رقم الإذن
- `statement_number` - رقم البيان
- `animal_count` - عدد الحيوانات
- `animal_type` - نوع الحيوان
- `quarantine_location` - مكان الحجر
- `clearance_status` - حالة الفسح
- `clearance_status_custom` - نص مخصص لحالة الفسح (اختياري)
- `created_at` - تاريخ الإنشاء
- `updated_at` - تاريخ آخر تحديث

### 2. تحديث وظيفة الحفظ

تم تحديث دالة `handleSaveDataEntry` لـ:
- ✅ التحقق من جميع الحقول المطلوبة الصحيحة
- ✅ حذف البيانات القديمة للإجراء (إن وجدت)
- ✅ حفظ البيانات الجديدة في Supabase
- ✅ عرض رسائل خطأ ونجاح واضحة

### 3. تحديث وظيفة التحميل

تم تحديث دالة `handleDataEntry` لـ:
- ✅ تحميل بيانات التجار المحفوظة تلقائياً عند فتح النافذة
- ✅ عرض البيانات المحفوظة في الحقول
- ✅ السماح بالتعديل على البيانات المحفوظة

## كيفية الاستخدام

### حفظ بيانات التجار

1. افتح سجل الحجر البيطري
2. اختر إجراء محجور
3. اضغط على "إدخال بيانات"
4. اضغط على "إضافة تاجر"
5. املأ جميع الحقول المطلوبة:
   - اسم التاجر
   - رقم الإذن
   - رقم البيان
   - عدد الحيوانات
   - نوع الحيوان
   - مكان الحجر
   - حالة الفسح
6. اضغط على "حفظ البيانات"
7. ستظهر رسالة "تم حفظ بيانات التجار بنجاح"

### تعديل بيانات محفوظة

1. افتح نفس الإجراء مرة أخرى
2. اضغط على "إدخال بيانات"
3. ستظهر البيانات المحفوظة تلقائياً
4. قم بالتعديل المطلوب
5. اضغط على "حفظ البيانات"
6. سيتم استبدال البيانات القديمة بالبيانات الجديدة

## التوافق

### ويندوز ✅
- يعمل بشكل كامل على Windows 10/11
- يتطلب اتصال بالإنترنت للحفظ والتحميل
- البيانات محفوظة في Supabase السحابية

### macOS ✅
- يعمل بشكل كامل
- نفس المتطلبات

### Linux ✅
- يعمل بشكل كامل
- نفس المتطلبات

## متطلبات التشغيل

1. **الاتصال بالإنترنت**: مطلوب للحفظ والتحميل من Supabase
2. **إعدادات Supabase**: يجب أن تكون صحيحة في ملف `.env`
3. **الصلاحيات**: المستخدم المصادق له صلاحيات كاملة على الجدول

## الأمان

- ✅ تم تفعيل Row Level Security (RLS) على الجدول
- ✅ يمكن للمستخدمين المصادقين فقط الوصول للبيانات
- ✅ البيانات محمية بتشفير SSL أثناء الإرسال
- ✅ لا يتم حفظ البيانات محلياً (فقط في السحابة)

## رسائل الخطأ المحتملة

### "يجب إضافة تاجر واحد على الأقل"
- **السبب**: لم تتم إضافة أي تاجر
- **الحل**: اضغط على "إضافة تاجر" وأدخل البيانات

### "يجب تعبئة جميع الحقول المطلوبة"
- **السبب**: أحد الحقول المطلوبة فارغ
- **الحل**: تأكد من ملء جميع الحقول:
  - اسم التاجر
  - رقم الإذن
  - رقم البيان
  - عدد الحيوانات
  - نوع الحيوان
  - مكان الحجر
  - حالة الفسح

### "لم يتم تحديد الإجراء"
- **السبب**: خطأ في اختيار الإجراء
- **الحل**: أغلق النافذة وافتح الإجراء مرة أخرى

### "حدث خطأ أثناء حفظ البيانات"
- **الأسباب المحتملة**:
  1. لا يوجد اتصال بالإنترنت
  2. خطأ في إعدادات Supabase
  3. مشكلة في الخادم
- **الحل**:
  1. تحقق من الاتصال بالإنترنت
  2. تحقق من إعدادات `.env`
  3. حاول مرة أخرى بعد دقيقة

## الدعم الفني

للمساعدة:
- **المطور**: عبدالعزيز محمد القرني
- **الدعم المادي**: فهد عبدالله الغامدي، شاكر سفر الثبيتي

---

**آخر تحديث**: 2025-10-21
